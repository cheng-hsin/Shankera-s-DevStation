---
title: 'åœ¨ EC2 æ›è¼‰ EFS å®Œæ•´æŒ‡å—'
date: '2025-11-16'
lastmod: '2025-11-16'
tags: ['aws', 'ec2', 'efs', 'storage']
draft: false
summary: 'åœ¨ EC2 ç’°å¢ƒä¸‹ï¼Œå¦‚ä½•æ­£ç¢ºæ›è¼‰ EFS æ–‡ä»¶ç³»çµ±ã€‚'
layout: PostSimple
bibliography: references-data.bib
canonicalUrl: https://tailwind-nextjs-starter-blog.vercel.app/blog/new-features-in-v1/
---

## ğŸ“‹ å‰è¨€

æœ¬æ–‡ä»‹ç´¹å¦‚ä½•åœ¨ AWS EC2 ä¸Šæ›è¼‰ EFS (Elastic File System)ï¼Œé‡é»åœ¨æ–¼é€é AWS Console è¨­å®šå®‰å…¨ç¾¤çµ„è¦å‰‡ï¼Œè®“ EC2 èƒ½å¤ é †åˆ©é€£æ¥ EFSã€‚

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

- **EFS ä½¿ç”¨ NFS å”å®š**ï¼šéœ€è¦é–‹æ”¾ TCP 2049 port
- **å®‰å…¨ç¾¤çµ„æ˜¯é—œéµ**ï¼šEFS çš„ SG å¿…é ˆå…è¨± EC2 çš„ SG é€£ç·š
- **è‡ªå‹•è§£æ Mount Target**ï¼šAWS æœƒè‡ªå‹•é¸æ“‡åŒ AZ çš„ mount targetï¼Œä¸éœ€æ‰‹å‹•å»ºç«‹

---

## ğŸ”§ å®Œæ•´æ“ä½œæµç¨‹

### 1ï¸âƒ£ è¨­å®š EFS çš„å®‰å…¨ç¾¤çµ„ï¼ˆSGï¼‰å…¥ç«™è¦å‰‡

åœ¨ AWS Console æ“ä½œï¼š

1. é€²å…¥ **EC2 Console** â†’ **Security Groups**
2. æ‰¾åˆ° **EFS ä½¿ç”¨çš„ Security Group**ï¼ˆé€šå¸¸ Description æœƒå¯« "allow efs mount" æˆ–åŒ…å« "efs" å­—æ¨£ï¼‰
3. é»é¸è©² SG â†’ **Inbound rules** â†’ **Edit inbound rules**
4. æ–°å¢ä»¥ä¸‹è¦å‰‡ï¼š

#### æ–¹æ³• Aï¼šä½¿ç”¨ Security Groupï¼ˆæ¨è–¦ï¼‰

| é¡å‹ | å”å®š | Port ç¯„åœ | ä¾†æº | èªªæ˜ |
|------|------|-----------|------|------|
| NFS | TCP | 2049 | `sg-xxxxxxxxx` | é¸æ“‡ä½ çš„ **EC2 ä½¿ç”¨çš„ Security Group**ï¼ˆä¾‹å¦‚ï¼šlaunch-wizard-4ï¼‰|

> ğŸ’¡ **æ“ä½œé‡é»**ï¼š
> - å…ˆæ‰¾åˆ° EFS çš„ SGï¼ˆDescription æœ‰ "allow efs mount"ï¼‰
> - åœ¨é€™å€‹ EFS SG è£¡é¢ï¼ŒåŠ å…¥ä½  EC2 ä½¿ç”¨çš„ SGï¼ˆä¾‹å¦‚ï¼šlaunch-wizard-4ï¼‰ä½œç‚ºä¾†æº
> - é€™æ¨£æ‰€æœ‰ä½¿ç”¨ launch-wizard-4 SG çš„ EC2 éƒ½èƒ½æ›è¼‰ EFS

#### æ–¹æ³• Bï¼šä½¿ç”¨ IP ç¯„åœï¼ˆè¼ƒä¸å½ˆæ€§ï¼‰

| é¡å‹ | å”å®š | Port ç¯„åœ | ä¾†æº | èªªæ˜ |
|------|------|-----------|------|------|
| NFS | TCP | 2049 | `0.0.0.0/0` | å…è¨±æ‰€æœ‰ä¾†æºï¼ˆæ¸¬è©¦ç”¨ï¼‰|
| NFS | TCP | 2049 | `10.10.0.0/16` | å…è¨±ç‰¹å®š VPC CIDR |

> ğŸ’¡ **å»ºè­°**ï¼šä½¿ç”¨ Security Group ä½œç‚ºä¾†æºï¼Œé€™æ¨£ç•¶ EC2 IP è®Šå‹•æ™‚ä¸éœ€è¦é‡æ–°è¨­å®šè¦å‰‡ã€‚

---

### 2ï¸âƒ£ åœ¨ EC2 å»ºç«‹æ›è¼‰ç›®éŒ„

SSH é€£ç·šåˆ°ä½ çš„ EC2 instanceï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
sudo mkdir -p /efs/mnt/efs_staging
```

> ğŸ“ **èªªæ˜**ï¼š`-p` åƒæ•¸æœƒè‡ªå‹•å»ºç«‹æ‰€æœ‰å¿…è¦çš„çˆ¶ç›®éŒ„ã€‚

---

### 3ï¸âƒ£ æ›è¼‰ EFS

ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ›è¼‰ EFSï¼ˆä½¿ç”¨ TLS åŠ å¯†ï¼‰ï¼š

```bash
sudo mount -t efs -o tls fs-0aadf2b60220c150a:/ /efs/mnt/efs_staging
```

**æŒ‡ä»¤èªªæ˜**ï¼š
- `-t efs`ï¼šæŒ‡å®šæª”æ¡ˆç³»çµ±é¡å‹ç‚º EFS
- `-o tls`ï¼šä½¿ç”¨ TLS åŠ å¯†å‚³è¼¸
- `fs-0aadf2b60220c150a`ï¼šä½ çš„ EFS File System ID
- `/efs/mnt/efs_staging`ï¼šEC2 ä¸Šçš„æ›è¼‰é»

> âš ï¸ **æ³¨æ„**ï¼šè«‹æ›¿æ› `fs-0aadf2b60220c150a` ç‚ºä½ å¯¦éš›çš„ EFS IDã€‚

---

### 4ï¸âƒ£ é©—è­‰æ›è¼‰

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ç¢ºèª EFS æ˜¯å¦æˆåŠŸæ›è¼‰ï¼š

```bash
df -h | grep efs_staging
```

**é æœŸè¼¸å‡º**ï¼š

```
127.0.0.1:/       8.0E     0  8.0E   0% /efs/mnt/efs_staging
```

å¦‚æœçœ‹åˆ°é¡ä¼¼è¼¸å‡ºï¼Œè¡¨ç¤ºæ›è¼‰æˆåŠŸï¼

---

## ğŸ” å¸¸è¦‹å•é¡Œæ’æŸ¥

### âŒ å•é¡Œ 1ï¼šæ›è¼‰å¤±æ•—ï¼Œé¡¯ç¤º "Connection timed out"

**åŸå› **ï¼šSecurity Group æ²’æœ‰æ­£ç¢ºè¨­å®š

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ EFS çš„ SG æ˜¯å¦æœ‰é–‹æ”¾ TCP 2049
2. ç¢ºèªä¾†æºåŒ…å«ä½ çš„ EC2 SG æˆ– IP ç¯„åœ
3. æª¢æŸ¥ EC2 å’Œ EFS æ˜¯å¦åœ¨åŒä¸€å€‹ VPC

### âŒ å•é¡Œ 2ï¼šæ›è¼‰å¾Œç„¡æ³•å¯«å…¥

**åŸå› **ï¼šæ¬Šé™è¨­å®šå•é¡Œ

**è§£æ±ºæ–¹æ³•**ï¼š

```bash
# ä¿®æ”¹æ›è¼‰é»æ¬Šé™
sudo chmod 777 /efs/mnt/efs_staging

# æˆ–è¨­å®šç‰¹å®šä½¿ç”¨è€…æ“æœ‰æ¬Š
sudo chown ec2-user:ec2-user /efs/mnt/efs_staging
```

### âŒ å•é¡Œ 3ï¼šé‡é–‹æ©Ÿå¾Œæ›è¼‰æ¶ˆå¤±

**åŸå› **ï¼šæ²’æœ‰è¨­å®šè‡ªå‹•æ›è¼‰

**è§£æ±ºæ–¹æ³•**ï¼šç·¨è¼¯ `/etc/fstab` åŠ å…¥è‡ªå‹•æ›è¼‰

```bash
sudo nano /etc/fstab
```

åŠ å…¥ä»¥ä¸‹å…§å®¹ï¼š

```
fs-0aadf2b60220c150a:/ /efs/mnt/efs_staging efs _netdev,tls 0 0
```

---

## ğŸ“Š AWS Console è¨­å®šæˆªåœ–èªªæ˜

å¦‚æœä½ åœ¨ AWS Console çœ‹åˆ° EFS çš„ Inbound Rules åƒé€™æ¨£ï¼š

```
10.10.160.0/20  â†’  TCP 2049
10.10.144.0/20  â†’  TCP 2049
10.10.128.0/20  â†’  TCP 2049
sg-0280a2c3729b1defe  â†’  TCP 2049
```

é€™äº›æ˜¯ AWS æ ¹æ“šä½ çš„ VPC Subnet è‡ªå‹•ç”¢ç”Ÿçš„è¦å‰‡ã€‚ä½ å¯ä»¥ï¼š

- **ä¿ç•™é€™äº›è¦å‰‡**ï¼šå¦‚æœä½ çš„ EC2 IP åœ¨é€™äº›ç¯„åœå…§
- **åªä¿ç•™ SG è¦å‰‡**ï¼šåˆªé™¤ IP è¦å‰‡ï¼Œåªç”¨ Security Group ä¾†æºï¼ˆæ›´å½ˆæ€§ï¼‰

---

## ğŸ’¡ å¯¦ç”¨æŠ€å·§

### 1. æ¸¬è©¦ EFS é€£ç·š

åœ¨æ›è¼‰å‰ï¼Œå…ˆæ¸¬è©¦ 2049 port æ˜¯å¦é€šï¼š

```bash
telnet fs-0aadf2b60220c150a.efs.ap-northeast-1.amazonaws.com 2049
```

### 2. æŸ¥çœ‹å·²æ›è¼‰çš„ EFS

```bash
mount | grep efs
```

### 3. å¸è¼‰ EFS

```bash
sudo umount /efs/mnt/efs_staging
```

---

## ğŸ“ ç¸½çµ

æ›è¼‰ EFS çš„ä¸‰å€‹é—œéµæ­¥é©Ÿï¼š

1. âœ… **è¨­å®šå®‰å…¨ç¾¤çµ„**ï¼šEFS SG é–‹æ”¾ TCP 2049 çµ¦ EC2 SG
2. âœ… **å»ºç«‹æ›è¼‰ç›®éŒ„**ï¼š`mkdir -p /efs/mnt/efs_staging`
3. âœ… **åŸ·è¡Œæ›è¼‰æŒ‡ä»¤**ï¼š`sudo mount -t efs -o tls <EFS-ID>:/ <æ›è¼‰é»>`

åªè¦å®‰å…¨ç¾¤çµ„è¨­å®šæ­£ç¢ºï¼ŒAWS æœƒè‡ªå‹•è™•ç†å…¶ä»–ç´°ç¯€ï¼ˆå¦‚é¸æ“‡æœ€è¿‘çš„ Mount Targetï¼‰ï¼Œæ•´å€‹éç¨‹éå¸¸ç°¡å–®ï¼

---

## ğŸ“š åƒè€ƒè³‡æº

- [AWS EFS å®˜æ–¹æ–‡ä»¶](https://docs.aws.amazon.com/efs/)
- [EFS Mount Helper å®‰è£æŒ‡å—](https://docs.aws.amazon.com/efs/latest/ug/mounting-fs-mount-helper.html)
- [Security Group æœ€ä½³å¯¦è¸](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html)