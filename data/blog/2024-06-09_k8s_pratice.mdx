---
title: 'Kubernetes å¯¦è¸æŒ‡å—'
date: '2024-06-09'
lastmod: '2024-06-09'
tags: ['Kubernetes', 'DevOps']
draft: false
summary: 'This is a practical guide to deploying applications, setting up autoscaling, and monitoring in Kubernetes.'
layout: PostSimple
bibliography: references-data.bib
canonicalUrl: https://tailwind-nextjs-starter-blog.vercel.app/blog/new-features-in-v1/
---

## éƒ¨ç½²æ‡‰ç”¨è‡³ Kubernetes

### 1. éƒ¨ç½²æ‡‰ç”¨

é¦–å…ˆï¼Œå‰µå»ºä¸¦æ‡‰ç”¨ä¸€å€‹ Deployment é…ç½®ï¼š

```bash
cat <<EOF > deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp
        image: nginx
        resources:
          requests:
            cpu: 100m
          limits:
            cpu: 200m
        ports:
        - containerPort: 80
EOF

# éƒ¨ç½² Deployment
kubectl apply -f deployment.yaml
```

### 2. å‰µå»ºä¸¦æ‡‰ç”¨ Service

æ¥ä¸‹ä¾†ï¼Œå‰µå»ºä¸¦æ‡‰ç”¨ä¸€å€‹ Service é…ç½®ï¼š

```bash
cat <<EOF > service.yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  selector:
    app: myapp
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: LoadBalancer
EOF

# æ‡‰ç”¨ Service é…ç½®
kubectl apply -f service.yaml
```

## è¨­ç½®è‡ªå‹•æ“´å±•ï¼ˆHorizontal Pod Autoscalingï¼‰

### 1. å‰µå»º HPA é…ç½®

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å‰µå»º HPA é…ç½®ä¸¦å¯«å…¥æ–‡ä»¶ hpa.yamlï¼š

```bash
cat <<EOF > hpa.yaml
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp-deployment
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 50
EOF

# æ‡‰ç”¨ HPA é…ç½®
kubectl apply -f hpa.yaml
```

### 2. é©—è­‰ HPA é…ç½®

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é©—è­‰ HPA æ˜¯å¦å·²æ­£ç¢ºå‰µå»ºä¸¦æ­£åœ¨é‹è¡Œï¼š

    ```bash
    kubectl get hpa
    ```

é€™å°‡é¡¯ç¤ºé›†ç¾¤ä¸­æ‰€æœ‰çš„ HPA è³‡æºåŠå…¶ç‹€æ…‹ã€‚

## ç›£æ§èˆ‡æ—¥èªŒç®¡ç†

å®‰è£ Prometheus å’Œ Grafana
ä½¿ç”¨ Helm å®‰è£ Prometheus å’Œ Grafanaï¼š

    ```bash
    # æ·»åŠ  Helm å­˜å„²åº«

helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update

# å®‰è£ Prometheus

helm install prometheus prometheus-community/prometheus

# å®‰è£ Grafana

helm install grafana grafana/grafana

````

é…ç½® Prometheus èˆ‡ Grafana é›†æˆ
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å‰µå»º Prometheus é…ç½®æ–‡ä»¶ prometheus.ymlï¼š

    ```bash
    cat <<EOF > prometheus.yml
global:
  scrape_interval: 15s
scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
EOF

# æ‡‰ç”¨ Prometheus é…ç½®
kubectl apply -f prometheus.yml
````

ç™»éŒ„ Grafana ä¸¦è¨­ç½®æ•¸æ“šæº
ç™»éŒ„ Grafanaï¼ˆé»˜èªç”¨æˆ¶åå¯†ç¢¼ï¼šadmin / adminï¼‰ï¼Œç„¶å¾Œæ·»åŠ  Prometheus ä½œç‚ºæ•¸æ“šæºä¸¦è¨­ç½®ç›£æ§å„€è¡¨æ¿ã€‚

## å®Œæ•´æµç¨‹ç¤ºä¾‹

1.  éƒ¨ç½²æ‡‰ç”¨ï¼š

        ```bash
        kubectl apply -f deployment.yaml
        ```

2.  å‰µå»ºä¸¦æ‡‰ç”¨ Serviceï¼š

        ```bash
        kubectl apply -f service.yaml
        ```

3.  å‰µå»ºä¸¦æ‡‰ç”¨ HPAï¼š

        ```bash
        kubectl apply -f hpa.yaml
        ```

4.  é©—è­‰ HPA é…ç½®ï¼š

        ```bash
        kubectl get hpa
        ```

5.  å®‰è£ Prometheus å’Œ Grafanaï¼š

        ```bash
          helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
          helm repo add grafana https://grafana.github.io/helm-charts
          helm repo update
          helm install prometheus prometheus-community/prometheus
          helm install grafana grafana/grafana
        ```

6.  æ‡‰ç”¨ Prometheus é…ç½®ï¼š
            ```bash
            kubectl apply -f prometheus.yml
            ```

é€™æ¨£ï¼Œæ‚¨å°±å®Œæˆäº†åœ¨ Kubernetes ä¸­éƒ¨ç½²æ‡‰ç”¨ã€è‡ªå‹•æ“´å±•ä»¥åŠè¨­ç½®ç›£æ§çš„åŸºæœ¬æ“ä½œã€‚å¸Œæœ›é€™äº›è³‡è¨Šå°æ‚¨æœ‰å¹«åŠ©ï¼ğŸ”¨ğŸ¤–ğŸ”§
